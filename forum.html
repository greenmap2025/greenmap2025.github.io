<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ°¸çºŒäº¤æµå°</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #43A047;
            --secondary: #2E7D32;
            --bg: #f0f2f5; /* é¡ä¼¼ FB çš„æ·ºç°åº•è‰² */
            --card-bg: #ffffff;
            --text: #1c1e21;
            --text-light: #65676b;
            --shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
        }

        /* --- å°è¦½åˆ— (ä¿æŒçµ±ä¸€) --- */
        nav {
            background: rgba(27, 94, 32, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        .nav-inner {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0.8rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .logo i { color: #8bc34a; }
        .nav-links { display: flex; gap: 15px; }
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            transition: 0.3s;
            display: flex; align-items: center; gap: 5px;
            font-size: 0.95rem;
        }
        .nav-links a:hover, .nav-links a.active {
            background: rgba(255,255,255,0.2);
        }
        /* æ‰‹æ©Ÿç‰ˆå°è¦½åˆ—èª¿æ•´ */
        @media(max-width:768px) {
            .nav-inner { flex-direction: column; gap: 10px; }
        }

        /* --- ä¸»è¦å…§å®¹å€ --- */
        .container {
            max-width: 800px; /* ç¸®çª„ä¸€é»ï¼Œè®“åƒæ‰‹æ©Ÿæ»‘å‹•çš„æ„Ÿè¦º */
            margin: 2rem auto;
            padding: 0 1rem;
        }

        /* 1. ä½¿ç”¨è€…è¨­å®šå€ & ç™¼æ–‡å€ */
        .card {
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: var(--shadow);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: 0.3s;
        }
        
        /* æš±ç¨±è¨­å®š */
        .user-profile {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        .avatar-preview {
            width: 50px; height: 50px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: bold; font-size: 1.2rem;
        }
        .user-input-group {
            flex: 1;
            display: flex;
            gap: 10px;
        }
        .user-input-group input {
            flex: 1; padding: 8px 12px; border: 1px solid #ddd; border-radius: 20px; outline: none;
        }
        .btn-small {
            background: var(--text-light); color: white; border: none; padding: 5px 15px; border-radius: 20px; cursor: pointer;
        }

        /* ç™¼æ–‡å€å¡Š */
        .create-post h3 { color: var(--secondary); margin-bottom: 15px; display: flex; align-items: center; gap: 8px; }
        .tag-selector { display: flex; gap: 10px; margin-bottom: 10px; }
        .tag-option {
            padding: 5px 12px; border-radius: 15px; font-size: 0.85rem; cursor: pointer; border: 1px solid #ddd; color: var(--text-light); transition: 0.2s;
        }
        .tag-option:hover, .tag-option.selected {
            background: var(--primary); color: white; border-color: var(--primary);
        }
        
        .post-input-area {
            width: 100%;
            border: none;
            background: #f0f2f5;
            padding: 15px;
            border-radius: 12px;
            font-size: 1rem;
            resize: none;
            outline: none;
            margin-bottom: 10px;
            font-family: inherit;
        }
        .post-input-area:focus { background: #e4e6eb; }
        
        .btn-post {
            background: var(--primary); color: white; border: none; padding: 10px 30px; border-radius: 8px; font-weight: bold; cursor: pointer; width: 100%; font-size: 1rem; transition: 0.2s;
        }
        .btn-post:hover { background: var(--secondary); transform: translateY(-2px); }

        /* 2. è²¼æ–‡åˆ—è¡¨ (Feed) */
        .post-card {
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            overflow: hidden;
            animation: fadeIn 0.5s ease;
        }
        @keyframes fadeIn { from { opacity:0; transform:translateY(20px); } to { opacity:1; transform:translateY(0); } }

        .post-header {
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .post-avatar {
            width: 40px; height: 40px; border-radius: 50%;
            background: #ddd; color: white;
            display: flex; align-items: center; justify-content: center;
            font-weight: bold; font-size: 1.1rem;
        }
        .post-info h4 { font-size: 1rem; margin-bottom: 2px; }
        .post-info span { font-size: 0.8rem; color: var(--text-light); }
        .post-tag {
            margin-left: auto;
            font-size: 0.8rem;
            padding: 4px 10px;
            border-radius: 12px;
            background: #e8f5e9;
            color: var(--secondary);
            font-weight: 500;
        }

        .post-content {
            padding: 5px 15px 15px 15px;
            font-size: 1.05rem;
            line-height: 1.6;
            color: #333;
        }

        .post-actions {
            border-top: 1px solid #eee;
            padding: 10px 15px;
            display: flex;
            gap: 20px;
        }
        .action-btn {
            background: none; border: none;
            color: var(--text-light);
            font-size: 0.95rem;
            cursor: pointer;
            display: flex; align-items: center; gap: 6px;
            transition: 0.2s;
            font-family: inherit;
        }
        .action-btn:hover { color: var(--primary); }
        .action-btn.liked { color: #e74c3c; }
        .action-btn.liked i { animation: pop 0.3s; }
        @keyframes pop { 50% { transform: scale(1.4); } }

        /* ç•™è¨€å€ */
        .comments-section {
            background: #f7f8fa;
            padding: 10px 15px;
            display: none; /* é è¨­éš±è—ï¼Œé»æ“Šæ‰é–‹ */
        }
        .comments-section.show { display: block; }
        
        .comment {
            display: flex; gap: 10px; margin-bottom: 10px;
        }
        .comment-avatar {
            width: 30px; height: 30px; border-radius: 50%; background: #ccc;
            display: flex; align-items: center; justify-content: center; font-size: 0.8rem; color: white;
        }
        .comment-bubble {
            background: #e4e6eb; padding: 8px 12px; border-radius: 15px; font-size: 0.9rem; flex: 1;
        }
        .comment-user { font-weight: bold; font-size: 0.85rem; margin-bottom: 2px; display: block; color: #111; }
        
        .comment-input-box {
            display: flex; gap: 10px; margin-top: 10px;
        }
        .comment-input-box input {
            flex: 1; padding: 8px 12px; border: 1px solid #ddd; border-radius: 20px; outline: none;
        }

        .empty-state {
            text-align: center; color: var(--text-light); padding: 40px;
        }
    </style>
</head>
<body>

<nav>
    <div class="nav-inner">
        <a href="index.html" class="logo"><i class="fas fa-leaf"></i> æ°¸çºŒæ¶ˆè²»åœ°åœ–</a>
        <div class="nav-links">
            <a href="index.html"><i class="fas fa-home"></i> é¦–é </a>
            <a href="map.html"><i class="fas fa-map-marked-alt"></i> æ¢ç´¢åœ°åœ–</a>
            <a href="forum.html" class="active"><i class="fas fa-comments"></i> äº¤æµå°</a>
        </div>
    </div>
</nav>

<div class="container">
    
    <div class="card">
        <div class="user-profile">
            <div class="avatar-preview" id="myAvatar">è¨ª</div>
            <div class="user-input-group">
                <input type="text" id="usernameInput" placeholder="è¨­å®šä½ çš„æš±ç¨±" maxlength="10">
                <button class="btn-small" onclick="saveUsername()">å„²å­˜</button>
            </div>
        </div>

        <div class="create-post">
            <h3><i class="fas fa-pen-fancy"></i> å»ºç«‹è²¼æ–‡</h3>
            
            <div class="tag-selector" id="tagSelector">
                <div class="tag-option selected" onclick="selectTag(this, 'å¿ƒå¾—')">ğŸŒ± å¿ƒå¾—åˆ†äº«</div>
                <div class="tag-option" onclick="selectTag(this, 'æ¨è–¦')">ğŸ‘ å¥½åº—æ¨è–¦</div>
                <div class="tag-option" onclick="selectTag(this, 'æå•')">â“ æ°¸çºŒæå•</div>
            </div>

            <textarea id="postContent" class="post-input-area" rows="3" placeholder="åœ¨æƒ³ä»€éº¼ï¼Ÿåˆ†äº«ä½ çš„æ°¸çºŒç”Ÿæ´»ç™¼ç¾..."></textarea>
            <button class="btn-post" onclick="submitPost()">ç™¼å¸ƒè²¼æ–‡</button>
        </div>
    </div>

    <div id="feedArea">
        </div>

</div>

<script>
    // --- 1. æ ¸å¿ƒè³‡æ–™é‚è¼¯ ---
    let currentUser = localStorage.getItem('forum_user') || 'è¨ªå®¢';
    let currentTag = 'å¿ƒå¾—';
    
    // åˆå§‹åŒ–
    document.getElementById('usernameInput').value = currentUser;
    updateAvatarUI(currentUser);
    renderFeed();

    // å„²å­˜æš±ç¨±
    function saveUsername() {
        const name = document.getElementById('usernameInput').value.trim();
        if(!name) return alert("è«‹è¼¸å…¥æš±ç¨±ï¼");
        currentUser = name;
        localStorage.setItem('forum_user', name);
        updateAvatarUI(name);
        alert("æš±ç¨±å·²æ›´æ–°ç‚ºï¼š" + name);
    }

    // æ›´æ–°é ­è²¼é¡è‰²èˆ‡æ–‡å­—
    function updateAvatarUI(name) {
        const avatar = document.getElementById('myAvatar');
        avatar.innerText = name[0];
        avatar.style.backgroundColor = stringToColor(name);
    }

    // é¸æ“‡æ¨™ç±¤
    function selectTag(el, tag) {
        document.querySelectorAll('.tag-option').forEach(d => d.classList.remove('selected'));
        el.classList.add('selected');
        currentTag = tag;
    }

    // ç”¢ç”Ÿé¡è‰² (æ ¹æ“šå­—ä¸²å›ºå®šç”¢ç”ŸæŸç¨®é¡è‰²)
    function stringToColor(str) {
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
            hash = str.charCodeAt(i) + ((hash << 5) - hash);
        }
        const c = (hash & 0x00FFFFFF).toString(16).toUpperCase();
        return '#' + "00000".substring(0, 6 - c.length) + c;
    }

    // --- 2. ç™¼æ–‡åŠŸèƒ½ ---
    function submitPost() {
        const content = document.getElementById('postContent').value.trim();
        if(!content) return alert("å…§å®¹ä¸èƒ½ç‚ºç©ºå–”ï¼");

        const posts = JSON.parse(localStorage.getItem('forum_posts') || '[]');
        
        const newPost = {
            id: Date.now(),
            user: currentUser,
            content: content,
            tag: currentTag,
            time: new Date().toLocaleString('zh-TW', { hour12:false, month:'numeric', day:'numeric', hour:'2-digit', minute:'2-digit' }),
            likes: 0,
            isLiked: false, // æœ¬åœ°æ¨¡æ“¬æ˜¯å¦æŒ‰è®š
            comments: []
        };

        posts.unshift(newPost); // åŠ åˆ°æœ€å‰é¢
        localStorage.setItem('forum_posts', JSON.stringify(posts));
        
        document.getElementById('postContent').value = ""; // æ¸…ç©º
        renderFeed(); // é‡æ–°æ¸²æŸ“
    }

    // --- 3. æ¸²æŸ“åˆ—è¡¨ (æœ€é‡è¦) ---
    function renderFeed() {
        const posts = JSON.parse(localStorage.getItem('forum_posts') || '[]');
        const feed = document.getElementById('feedArea');
        feed.innerHTML = "";

        if(posts.length === 0) {
            feed.innerHTML = `<div class="empty-state">ç›®å‰é‚„æ²’æœ‰è²¼æ–‡ï¼Œå¿«ä¾†æ¶é ­é¦™ï¼</div>`;
            return;
        }

        posts.forEach(post => {
            const avatarColor = stringToColor(post.user);
            const likeClass = post.isLiked ? 'liked' : '';
            
            // ç”¢ç”Ÿç•™è¨€ HTML
            let commentsHtml = post.comments.map(c => `
                <div class="comment">
                    <div class="comment-avatar" style="background:${stringToColor(c.user)}">${c.user[0]}</div>
                    <div class="comment-bubble">
                        <span class="comment-user">${c.user}</span>
                        ${c.content}
                    </div>
                </div>
            `).join('');

            const html = `
                <div class="post-card">
                    <div class="post-header">
                        <div class="post-avatar" style="background:${avatarColor}">${post.user[0]}</div>
                        <div class="post-info">
                            <h4>${post.user}</h4>
                            <span>${post.time}</span>
                        </div>
                        <span class="post-tag"># ${post.tag}</span>
                    </div>
                    <div class="post-content">
                        ${post.content.replace(/\n/g, '<br>')}
                    </div>
                    <div class="post-actions">
                        <button class="action-btn ${likeClass}" onclick="toggleLike(${post.id})">
                            <i class="fas fa-heart"></i> ${post.likes}
                        </button>
                        <button class="action-btn" onclick="toggleComment(${post.id})">
                            <i class="fas fa-comment-alt"></i> ${post.comments.length} ç•™è¨€
                        </button>
                        <button class="action-btn" onclick="deletePost(${post.id})" style="margin-left:auto; color:#999;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    
                    <div class="comments-section" id="comment-box-${post.id}">
                        <div id="comment-list-${post.id}">${commentsHtml}</div>
                        <div class="comment-input-box">
                            <input type="text" id="input-${post.id}" placeholder="ç•™è¨€...">
                            <button class="btn-small" style="background:var(--primary)" onclick="addComment(${post.id})">é€å‡º</button>
                        </div>
                    </div>
                </div>
            `;
            feed.innerHTML += html;
        });
    }

    // --- 4. äº’å‹•åŠŸèƒ½ ---
    function toggleLike(id) {
        const posts = JSON.parse(localStorage.getItem('forum_posts'));
        const post = posts.find(p => p.id === id);
        
        if(post.isLiked) {
            post.likes--;
            post.isLiked = false;
        } else {
            post.likes++;
            post.isLiked = true;
        }
        localStorage.setItem('forum_posts', JSON.stringify(posts));
        renderFeed();
    }

    function toggleComment(id) {
        const box = document.getElementById(`comment-box-${id}`);
        box.classList.toggle('show');
    }

    function addComment(id) {
        const input = document.getElementById(`input-${id}`);
        const val = input.value.trim();
        if(!val) return;

        const posts = JSON.parse(localStorage.getItem('forum_posts'));
        const post = posts.find(p => p.id === id);
        
        post.comments.push({
            user: currentUser,
            content: val
        });
        
        localStorage.setItem('forum_posts', JSON.stringify(posts));
        renderFeed();
        // ä¿æŒç•™è¨€å€é–‹å•Ÿ
        setTimeout(() => document.getElementById(`comment-box-${id}`).classList.add('show'), 50);
    }

    function deletePost(id) {
        if(!confirm("ç¢ºå®šè¦åˆªé™¤é€™ç¯‡è²¼æ–‡å—ï¼Ÿ")) return;
        let posts = JSON.parse(localStorage.getItem('forum_posts'));
        posts = posts.filter(p => p.id !== id);
        localStorage.setItem('forum_posts', JSON.stringify(posts));
        renderFeed();
    }
</script>

</body>
</html>
